# Сайт родословной
Создание закрытого сайта семейной родословной. Создаётся карточка на каждого члена семьи, содержащая сведения о фамилии, имени, отчестве, прежних фамилиях, дате рождения, адресах проживания, родах деятельности, телефонах иных данных. Организован поиск по списку, сортировка. Динамически создаётся древо на каждого члена семьи в формате SVG, которое можно скачать. Также можно скачать всю родословную в формате PDF или карточку на отдельного члена семьи. Возможно создание подписки на рассылку о ближайших событиях членов семьи (день рождение, день памяти).

## Требования
- PHP 8.0 или выше  
- Composer 
- Git
- MySql

## Инструкция для установки
При помощии git клонируйте репозиторий

    git clone https://github.com/mldanshin/gen

Установите зависимости с помощью composer

    composer install --optimize-autoloader --no-dev

Создайте символьную ссылку

    ln -s ../storage/app/public public/storage

Создайте базу данных с кодировкой utf8mb4_general_ci  

Создайте файл .env:

    cp .env.example .env

и *обязательно установите значения*
- APP_URL  
- DB_DATABASE  
- DB_USERNAME  
- DB_PASSWORD  
- MAIL_MAILER=smtp
- MAIL_HOST=
- MAIL_PORT=
- MAIL_USERNAME=
- MAIL_PASSWORD=
- MAIL_FROM_ADDRESS=
- SMS_RU_ID=  
- TELEGRAM_BOT_TOKEN=  

Приложение использует API [SMS RU](https://sms.ru/api), [Telegram](https://core.telegram.org/), поэтому Вам необходимо получить соответствующие токены, добавив в указанный файл .env.

Заполните базу данных, выполнив

    php artisan migrate
    php artisan db:seed

В связи с тем, что вход на сайт только после регистрации, а зарегистрироваться может только член семьи, Вам необходимо создать одного члена семьи, в таблице 'people'. Привязать к нему телефон или email, соответствоенно в таблице phones или emails. Номер телефона только из цифр, без пробелов, 7, 8.   
Добавьте роль администратора созданного члена семьи в таблице people_role. По умолчанию роль будет установлена, как обычный пользователь.  
Затем пройдите регистрацию.  
После чего добавление членов семьи доступно через приложение.  

Добавьте в планировщик заданий выполнение команды, для удаления временных данных  
- php artisan download:clear
- php artisan photo:clear 

Добавьте в планировщик заданий, для рассылки сведений о ближайших событиях
- php artisan send:events

## Использование
Поддерживаются локализации: en, ru. Для чего нужно изменить локализацию в конфигурационном файле 'app.php'.   
Вход на сайт осуществляется исключительно через логин и пароль. Вы можете изменить это поведения, удалив посредника 'auth' на группе маршрутов.  
Зарегистрироваться может только лицо из генеалогического древа, имеющее телефон или email, который должен иметься в соответствующей таблицы БД.  
Установлены три возможные роли: администратор, vip пользователь, и обычный. Первые два могут выполнять CRUD операции с членами семьи.  
Можно оформить подписку на получение "ближайших событий", доступно оформление только для телеграмм.  
Фото размещается в каталоге storage/app/public/photo.  
Приложение поддерживает нестандартный формат дат, с символом вопросительного знака (?), который заменяет неизвестное число в дате. Поэтому в коде нельзя использовать стандартные функции и элементы дат PHP, JS и HTML.  
Связь мама+ребеонок и папа+ребенок построены на принципе, что у ребенка может только быть один папа или мама.  

### Консольные команды
- php artisan download:clear
- php artisan lang:json
- php artisan photo:clear
- php artisan send:events

## Тестирование
Для запуска тестов выполните  

    php artisan test

## Демонстрационный сайт
[Демонстрационный пример](https://demo-gen.danshin.net) c локализацией 'en', часть функционала отключена или может выдавать ошибки, из-за отсутствия переменных окружения.  
Администратор

- Логин: admin@fake.rus  
- Пароль: admin

Обычный пользователь  
- Логин: user@fake.rus  
- Пароль: user  

## Контакты
mail@danshin.net

## Лицензия

Программное обеспечение с открытым исходным кодом, лицензированное в соответствии с [MIT license](https://opensource.org/licenses/MIT).
